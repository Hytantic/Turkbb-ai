<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TurkBBIai Pro - Geli≈ümi≈ü Chatbot</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Markdown ve Syntax Highlighting -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            height: 100vh;
            overflow: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3), transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(138, 43, 226, 0.3), transparent 50%);
            animation: float 15s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(20px, 20px); }
        }

        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
            z-index: 1;
        }

        .sidebar {
            width: 300px;
            background: rgba(17, 24, 39, 0.95);
            backdrop-filter: blur(10px);
            color: white;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s;
        }


        .sidebar-header {
            padding: 25px 20px;
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h1 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-header p {
            font-size: 12px;
            opacity: 0.8;
        }

        .new-chat-btn {
            margin: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .new-chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .chat-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .chat-item {
            padding: 15px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
        }

        .chat-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .chat-item.active {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .chat-item-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-item-preview {
            font-size: 12px;
            opacity: 0.7;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .delete-chat {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(239, 68, 68, 0.8);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 16px;
        }

        .chat-item:hover .delete-chat {
            opacity: 1;
        }

        .delete-chat:hover {
            background: rgba(239, 68, 68, 1);
        }

        .settings-section {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .header-left h2 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .header-left p {
            font-size: 13px;
            opacity: 0.9;
        }

        .header-right {
            display: flex;
            gap: 10px;
        }

        .header-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        #liveCallBtn {
            font-weight: 600;
        }

        .api-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .api-modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .modal-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: white;
        }

        .modal-btn.secondary {
            background: #e5e7eb;
            color: #333;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: linear-gradient(to bottom, #f9fafb 0%, #ffffff 100%);
        }

        .message {
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            color: white;
        }

        .message.ai .message-avatar {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: white;
        }

        .message-content {
            max-width: 70%;
            padding: 16px 20px;
            border-radius: 18px;
            line-height: 1.6;
            word-wrap: break-word;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.ai .message-content {
            background: white;
            color: #333;
            border: 1px solid #e5e7eb;
            border-bottom-left-radius: 5px;
        }

        .message-content code {
            background: rgba(0, 0, 0, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .message.user .message-content code {
            background: rgba(255, 255, 255, 0.2);
        }

        .message-content pre {
            background: #0d1117;
            padding: 0;
            border-radius: 8px;
            overflow-x: auto;
            margin: 10px 0;
        }

        .message-content pre code {
            background: none;
            padding: 16px;
            display: block;
            color: #c9d1d9;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        .message-content p {
            margin: 8px 0;
        }

        .message-content ul, .message-content ol {
            margin: 8px 0;
            padding-left: 24px;
        }

        .message-content li {
            margin: 4px 0;
        }

        .message-content blockquote {
            border-left: 4px solid #8b5cf6;
            padding-left: 16px;
            margin: 12px 0;
            color: #6b7280;
            font-style: italic;
        }

        .message-content h1, .message-content h2, .message-content h3 {
            margin: 16px 0 8px 0;
            font-weight: 600;
        }

        .message-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 12px 0;
        }

        .message-content th, .message-content td {
            border: 1px solid #e5e7eb;
            padding: 8px 12px;
            text-align: left;
        }

        .message-content th {
            background: #f3f4f6;
            font-weight: 600;
        }

        .typing-indicator {
            display: none;
            padding: 20px;
            align-items: center;
            gap: 15px;
        }

        .typing-indicator.active {
            display: flex;
        }

        .typing-dots {
            display: flex;
            gap: 5px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #8b5cf6;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .input-container {
            padding: 25px 30px;
            background: white;
            border-top: 1px solid #e5e7eb;
            box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.05);
        }

        .input-box {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .input-box input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 30px;
            font-size: 15px;
            font-family: 'Poppins', sans-serif;
            outline: none;
            transition: all 0.3s;
        }

        .input-box input:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
        }

        .input-box button {
            padding: 16px 35px;
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .input-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .input-box button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 2000;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .toast.active {
            display: block;
        }

        .toast.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .voice-btn {
            padding: 12px 16px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-btn:hover {
            background: #f3f4f6;
            transform: scale(1.1);
        }

        .voice-btn.active {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-color: #ef4444;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .voice-btn.speaking {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
            animation: pulse 1.5s infinite;
        }

        .camera-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }

        .camera-modal.active {
            display: flex;
        }

        .camera-content {
            background: #1f2937;
            padding: 20px;
            border-radius: 20px;
            max-width: 800px;
            width: 90%;
            position: relative;
        }

        .camera-content video {
            width: 100%;
            border-radius: 15px;
            background: #000;
        }

        .camera-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .camera-controls button {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .close-camera {
            background: #ef4444;
            color: white;
        }

        .close-camera:hover {
            background: #dc2626;
        }

        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 40px;
        }

        .welcome-screen h2 {
            font-size: 32px;
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .welcome-screen p {
            font-size: 16px;
            color: #6b7280;
            margin-bottom: 30px;
        }

        .suggestion-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 600px;
            margin-top: 20px;
        }

        .suggestion-card {
            padding: 20px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .suggestion-card:hover {
            border-color: #8b5cf6;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.2);
        }

        .suggestion-card h4 {
            font-size: 14px;
            color: #8b5cf6;
            margin-bottom: 8px;
        }

        .suggestion-card p {
            font-size: 13px;
            color: #6b7280;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -300px;
                height: 100vh;
                z-index: 100;
            }

            .sidebar.active {
                transform: translateX(300px);
            }

            .suggestion-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>ü§ñ TurkBBIai Pro</h1>
                <p>Geli≈ümi≈ü Yapay Zeka Asistanƒ±</p>
            </div>

            <button class="new-chat-btn" onclick="createNewChat()">
                ‚ú® Yeni Sohbet Ba≈ülat
            </button>

            <div class="chat-list" id="chatList"></div>

            <div class="settings-section">
                <div class="theme-toggle" onclick="openApiModal()">
                    <span>‚öôÔ∏è API Ayarlarƒ±</span>
                    <span>‚Üí</span>
                </div>
                <div class="theme-toggle" onclick="changeUserName()" style="margin-top: 10px;">
                    <span>üë§ ƒ∞smi Deƒüi≈ütir</span>
                    <span>‚Üí</span>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="header">
                <div class="header-left">
                    <h2 id="currentChatTitle">Yeni Sohbet</h2>
                    <p>TurkBBIai - T√ºrk Yapay Zeka Asistanƒ±</p>
                </div>
                <div class="header-right">
                    <button class="header-btn" id="userProfileBtn" onclick="openLoginModal()">
                        <span id="userProfileIcon">üë§</span>
                        <span id="userProfileName">Giri≈ü Yap</span>
                    </button>
                    <button class="header-btn" id="liveCallBtn" onclick="toggleLiveCall()">üìû Canlƒ± Konu≈üma</button>
                    <button class="header-btn" onclick="openImageGeneratorModal()">üé® G√∂rsel Olu≈ütur</button>
                    <button class="header-btn" onclick="clearCurrentChat()">üóëÔ∏è Temizle</button>
                    <button class="header-btn" onclick="exportChat()">üì• Dƒ±≈üa Aktar</button>
                </div>
            </div>

            <div class="chat-container" id="chatContainer">
                <div class="welcome-screen">
                    <h2>TurkBBIai Pro'ya Ho≈ü Geldiniz! üöÄ</h2>
                    <p>Size nasƒ±l yardƒ±mcƒ± olabilirim? A≈üaƒüƒ±daki √∂nerilerden birini se√ßebilir veya kendi sorunuzu sorabilirsiniz.</p>
                    <div class="suggestion-cards">
                        <div class="suggestion-card" onclick="useSuggestion('Python ile web scraping nasƒ±l yapƒ±lƒ±r?')">
                            <h4>üíª Kodlama</h4>
                            <p>Python ile web scraping nasƒ±l yapƒ±lƒ±r?</p>
                        </div>
                        <div class="suggestion-card" onclick="useSuggestion('Yapay zeka ve makine √∂ƒürenmesi arasƒ±ndaki fark nedir?')">
                            <h4>üß† Yapay Zeka</h4>
                            <p>AI ve ML arasƒ±ndaki fark</p>
                        </div>
                        <div class="suggestion-card" onclick="useSuggestion('Bana ilgin√ß bir bilim kurgu hikayesi anlat')">
                            <h4>üìö Yaratƒ±cƒ±lƒ±k</h4>
                            <p>ƒ∞lgin√ß bir hikaye anlat</p>
                        </div>
                        <div class="suggestion-card" onclick="useSuggestion('Saƒülƒ±klƒ± ya≈üam i√ßin g√ºnl√ºk rutinler √∂ner')">
                            <h4>üèÉ Saƒülƒ±k</h4>
                            <p>Saƒülƒ±klƒ± ya≈üam rutinleri</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="message-avatar" style="background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);">AI</div>
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>

            <div class="input-container">
                <div class="input-box">
                    <button class="voice-btn" id="micBtn" onclick="toggleVoiceInput()" title="Sesli mesaj">
                        üé§
                    </button>
                    <button class="voice-btn" id="cameraBtn" onclick="toggleCamera()" title="Kamera a√ß/kapat">
                        üì∑
                    </button>
                    <input 
                        type="text" 
                        id="userInput" 
                        placeholder="Mesajƒ±nƒ±zƒ± buraya yazƒ±n..." 
                        onkeypress="handleKeyPress(event)">
                    <button class="voice-btn" id="speakerBtn" onclick="toggleAutoSpeak()" title="Otomatik sesli okuma">
                        üîá
                    </button>
                    <button onclick="sendMessage()" id="sendButton">G√∂nder üöÄ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="api-modal" id="loginModal">
        <div class="modal-content">
            <h3>üë§ Hesap Giri≈üi</h3>
            <p style="font-size: 13px; color: #6b7280; margin-bottom: 20px;">
                Giri≈ü yapmak i√ßin email adresinizi kullanƒ±n
            </p>
            
            <!-- Email Giri≈ü Formu -->
            <div id="emailLoginForm">
                <input type="email" class="modal-input" id="emailInput" placeholder="Email adresiniz" />
                <button class="modal-btn primary" onclick="sendVerificationCode()" style="width: 100%; margin-top: 10px;" id="sendCodeBtn">
                    üìß Doƒürulama Kodu G√∂nder
                </button>
            </div>
            
            <!-- Kod Doƒürulama Formu -->
            <div id="codeVerificationForm" style="display: none;">
                <p style="font-size: 13px; color: #6b7280; margin-bottom: 10px;">
                    <span id="sentEmailDisplay"></span> adresine kod g√∂nderdik
                </p>
                <input type="text" class="modal-input" id="codeInput" placeholder="6 haneli kodu girin" maxlength="6" />
                <button class="modal-btn primary" onclick="verifyCode()" style="width: 100%; margin-top: 10px;">
                    ‚úÖ Doƒürula
                </button>
                <button class="modal-btn secondary" onclick="backToEmailForm()" style="width: 100%; margin-top: 5px;">
                    ‚Üê Geri
                </button>
            </div>
            
            <div style="text-align: center; margin: 15px 0; color: #9ca3af;">veya</div>
            
            <!-- Misafir Giri≈üi -->
            <button class="modal-btn secondary" onclick="continueAsGuest()" style="width: 100%;">
                üö™ Misafir Olarak Devam Et
            </button>
            
            <!-- Kullanƒ±cƒ± Bilgileri -->
            <div id="userInfoDisplay" style="display: none; margin-top: 20px; padding: 15px; background: #f3f4f6; border-radius: 10px;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <img id="userAvatar" style="width: 50px; height: 50px; border-radius: 50%;" />
                    <div>
                        <div style="font-weight: 600;" id="userDisplayName"></div>
                        <div style="font-size: 12px; color: #6b7280;" id="userEmail"></div>
                    </div>
                </div>
                <button class="modal-btn secondary" onclick="signOut()" style="width: 100%;">
                    üö™ √áƒ±kƒ±≈ü Yap
                </button>
            </div>
        </div>
    </div>

    <div class="api-modal" id="apiModal">
        <div class="modal-content">
            <h3>üîë API Anahtarƒ± Ayarlarƒ±</h3>
            <p style="font-size: 13px; color: #6b7280; margin-bottom: 15px;">
                OpenAI API anahtarƒ± alabilirsiniz: 
                <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #8b5cf6;">Buradan</a>
            </p>
            <input 
                type="password" 
                class="modal-input" 
                id="apiKeyInput" 
                placeholder="OpenAI API Anahtarƒ±nƒ±zƒ± girin (sk-...)">
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeApiModal()">ƒ∞ptal</button>
                <button class="modal-btn primary" onclick="saveApiKey()">Kaydet</button>
            </div>
        </div>
    </div>

    <div class="api-modal" id="imageGeneratorModal">
        <div class="modal-content">
            <h3>üé® G√∂rsel Olu≈üturucu</h3>
            <p style="font-size: 13px; color: #6b7280; margin-bottom: 15px;">
                Olu≈üturmak istediƒüiniz g√∂rseli detaylƒ± bir ≈üekilde tanƒ±mlayƒ±n
            </p>
            <textarea 
                class="modal-input" 
                id="imagePromptInput" 
                placeholder="√ñrnek: Tatlƒ± beyaz bir kedi yavrusu, mavi g√∂zl√º, bah√ßede oynarken"
                rows="4"
                style="resize: vertical;"></textarea>
            <div id="imageResult" style="margin-top: 15px; text-align: center; display: none;">
                <img id="generatedImage" style="max-width: 100%; border-radius: 10px; margin-top: 10px;" />
                <p id="imageStatus" style="margin-top: 10px; font-size: 13px; color: #6b7280;"></p>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeImageGeneratorModal()">Kapat</button>
                <button class="modal-btn primary" onclick="generateImage()" id="generateImageBtn">üé® Olu≈ütur</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <div class="camera-modal" id="cameraModal">
        <div class="camera-content">
            <video id="cameraVideo" autoplay playsinline></video>
            <div class="camera-controls">
                <button class="close-camera" onclick="toggleCamera()">üì∑ Kamerayƒ± Kapat</button>
            </div>
        </div>
    </div>

    <div class="camera-modal" id="liveCallModal">
        <div class="camera-content" style="max-width: 1000px;">
            <div style="position: relative;">
                <video id="liveCallVideo" autoplay playsinline style="width: 100%; border-radius: 15px;"></video>
                <div style="position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.7); color: white; padding: 10px 20px; border-radius: 10px; font-weight: 600;">
                    <span id="liveCallStatus">üî¥ CANLI</span>
                </div>
                <div style="position: absolute; bottom: 20px; left: 20px; right: 20px; background: rgba(0,0,0,0.7); color: white; padding: 15px; border-radius: 10px; font-size: 14px; max-height: 150px; overflow-y: auto;" id="liveTranscript">
                    Konu≈ümaya hazƒ±r...
                </div>
            </div>
            <div class="camera-controls" style="margin-top: 20px;">
                <button style="background: #3b82f6; color: white; padding: 12px 24px; border-radius: 10px; border: none; cursor: pointer; font-weight: 600;" onclick="analyzeLiveVideo()">
                    üëÅÔ∏è G√∂r√ºnt√ºy√º Analiz Et
                </button>
                <button style="background: #10b981; color: white; padding: 12px 24px; border-radius: 10px; border: none; cursor: pointer; font-weight: 600;" id="liveMicBtn" onclick="toggleLiveMic()">
                    üé§ Mikrofonu A√ß
                </button>
                <button class="close-camera" onclick="toggleLiveCall()">
                    ‚ùå Canlƒ± Konu≈ümayƒ± Kapat
                </button>
            </div>
        </div>
    </div>

    <script>
        // API key artƒ±k backend'de, g√ºvenli!
        
        // Backend API endpoint (API keyler backend'de g√ºvenli)
        const BACKEND_URL = 'http://localhost:5000';
        
        // Marked.js yapƒ±landƒ±rmasƒ±
        marked.setOptions({
            breaks: true,
            gfm: true
        });
        
        let chats = [];
        try {
            chats = JSON.parse(localStorage.getItem('turkbbiai_chats')) || [];
        } catch (e) {
            console.error('Sohbet ge√ßmi≈üi y√ºklenirken hata:', e);
            chats = [];
        }

        let currentChatId = localStorage.getItem('current_chat_id') || null;
        let userName = localStorage.getItem('user_name') || null;
        let userEmail = localStorage.getItem('user_email') || null;
        let userPhoto = localStorage.getItem('user_photo') || null;
        let isGuestMode = localStorage.getItem('is_guest_mode') === 'true';
        let isCreator = localStorage.getItem('is_creator') === 'true';
        const CREATOR_NAME = 'Ali'; // Yapƒ±mcƒ±nƒ±n adƒ±
        let isRecording = false;
        let recognition = null;
        let autoSpeak = false;
        let cameraStream = null;
        let isSpeaking = false;
        let liveCallActive = false;
        let liveCallStream = null;
        let liveMicActive = false;
        let liveRecognition = null;
        let conversationHistory = [];

        // Speech Recognition API
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = 'tr-TR';
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('userInput').value = transcript;
                isRecording = false;
                document.getElementById('micBtn').classList.remove('active');
                showToast('‚úÖ Ses tanƒ±ndƒ±: ' + transcript, 'success');
            };

            recognition.onerror = function(event) {
                isRecording = false;
                document.getElementById('micBtn').classList.remove('active');
                showToast('‚ùå Ses tanƒ±ma hatasƒ±: ' + event.error, 'error');
            };

            recognition.onend = function() {
                isRecording = false;
                document.getElementById('micBtn').classList.remove('active');
            };
        }

        // Canlƒ± konu≈üma i√ßin ayrƒ± speech recognition
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            liveRecognition = new SpeechRecognition();
            liveRecognition.lang = 'tr-TR';
            liveRecognition.continuous = true;
            liveRecognition.interimResults = true;

            liveRecognition.onresult = function(event) {
                const last = event.results.length - 1;
                const transcript = event.results[last][0].transcript;
                
                document.getElementById('liveTranscript').innerHTML = 'üé§ Siz: ' + transcript;
                
                // Final result - AI'ya g√∂nder
                if (event.results[last].isFinal) {
                    handleLiveConversation(transcript);
                }
            };

            liveRecognition.onerror = function(event) {
                console.error('Live recognition error:', event.error);
                if (liveMicActive && event.error !== 'no-speech') {
                    showToast('‚ùå Ses hatasƒ±: ' + event.error, 'error');
                }
            };

            liveRecognition.onend = function() {
                if (liveMicActive) {
                    // S√ºrekli dinlemeye devam et
                    try {
                        liveRecognition.start();
                    } catch (e) {
                        console.error('Restart error:', e);
                    }
                }
            };
        }

        // Sayfa y√ºklendiƒüinde
        window.onload = function() {
            updateUserProfile();
            
            if (chats.length === 0) {
                createNewChat();
            } else {
                renderChatList();
                if (currentChatId) {
                    loadChat(currentChatId);
                } else {
                    loadChat(chats[0].id);
                }
            }
            
            // Kullanƒ±cƒ± adƒ± yoksa ve misafir deƒüilse giri≈ü modalƒ± a√ß
            if (!userName && !isGuestMode) {
                setTimeout(() => openLoginModal(), 1000);
            }
            
            showToast('‚ú® TurkBBIai Pro hazƒ±r!', 'success');
        };

        function openLoginModal() {
            document.getElementById('loginModal').classList.add('active');
            if (userName) showUserInfo();
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        function continueAsGuest() {
            const guestName = prompt('Misafir adƒ±nƒ±zƒ± girin:', 'Misafir');
            if (guestName && guestName.trim()) {
                userName = guestName.trim();
                isGuestMode = true;
                localStorage.setItem('user_name', userName);
                localStorage.setItem('is_guest_mode', 'true');
                localStorage.removeItem('user_email');
                localStorage.removeItem('user_photo');
                updateUserProfile();
                closeLoginModal();
                showToast(`üëã Merhaba ${userName}!`, 'success');
            }
        }

        function signOut() {
            userName = userEmail = userPhoto = null;
            isGuestMode = false;
            localStorage.removeItem('user_name');
            localStorage.removeItem('user_email');
            localStorage.removeItem('user_photo');
            localStorage.removeItem('is_guest_mode');
            updateUserProfile();
            closeLoginModal();
            showToast('üëã G√∂r√º≈ümek √ºzere!', 'success');
            setTimeout(() => location.reload(), 1000);
        }

        function updateUserProfile() {
            const profileIcon = document.getElementById('userProfileIcon');
            const profileName = document.getElementById('userProfileName');
            if (userName) {
                if (userPhoto && !isGuestMode) {
                    profileIcon.innerHTML = `<img src="${userPhoto}" style="width: 24px; height: 24px; border-radius: 50%;" />`;
                } else {
                    profileIcon.textContent = isGuestMode ? 'üö™' : 'üë§';
                }
                profileName.textContent = userName.split(' ')[0];
            } else {
                profileIcon.textContent = 'üë§';
                profileName.textContent = 'Giri≈ü Yap';
            }
        }

        function showUserInfo() {
            const userInfoDisplay = document.getElementById('userInfoDisplay');
            const userDisplayName = document.getElementById('userDisplayName');
            const userEmailDisplay = document.getElementById('userEmail');
            const userAvatar = document.getElementById('userAvatar');
            if (userName) {
                userDisplayName.textContent = userName;
                userEmailDisplay.textContent = isGuestMode ? 'Misafir Kullanƒ±cƒ±' : (userEmail || '');
                if (userPhoto && !isGuestMode) {
                    userAvatar.src = userPhoto;
                    userAvatar.style.display = 'block';
                } else {
                    userAvatar.style.display = 'none';
                }
                userInfoDisplay.style.display = 'block';
                document.getElementById('emailLoginForm').style.display = 'none';
            } else {
                userInfoDisplay.style.display = 'none';
                document.getElementById('emailLoginForm').style.display = 'block';
            }
        }

        // Email Doƒürulama Fonksiyonlarƒ±
        let pendingEmail = '';
        const EMAIL_SERVER = 'http://localhost:5000';

        async function sendVerificationCode() {
            const email = document.getElementById('emailInput').value.trim();
            
            if (!email || !email.includes('@')) {
                showToast('‚ùå Ge√ßerli bir email girin!', 'error');
                return;
            }
            
            pendingEmail = email;
            const sendCodeBtn = document.getElementById('sendCodeBtn');
            sendCodeBtn.disabled = true;
            sendCodeBtn.textContent = '‚è≥ G√∂nderiliyor...';
            
            try {
                const response = await fetch(`${EMAIL_SERVER}/send-code`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('emailLoginForm').style.display = 'none';
                    document.getElementById('codeVerificationForm').style.display = 'block';
                    document.getElementById('sentEmailDisplay').textContent = email;
                    showToast('‚úÖ Doƒürulama kodu g√∂nderildi!', 'success');
                    
                    // Debug i√ßin (email sunucusu √ßalƒ±≈ümƒ±yorsa)
                    if (data.debug_code) {
                        console.log('üîê DEBUG KOD:', data.debug_code);
                        showToast('‚ö†Ô∏è Kod console\'da: ' + data.debug_code, 'success');
                    }
                } else {
                    showToast('‚ùå Kod g√∂nderilemedi!', 'error');
                }
            } catch (error) {
                console.error('Email error:', error);
                showToast('‚ùå Sunucuya baƒülanƒ±lamadƒ±! Email sunucusu √ßalƒ±≈üƒ±yor mu?', 'error');
            } finally {
                sendCodeBtn.disabled = false;
                sendCodeBtn.textContent = 'üìß Doƒürulama Kodu G√∂nder';
            }
        }

        async function verifyCode() {
            const code = document.getElementById('codeInput').value.trim();
            
            if (!code || code.length !== 6) {
                showToast('‚ùå 6 haneli kodu girin!', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${EMAIL_SERVER}/verify-code`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: pendingEmail, code })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Giri≈ü ba≈üarƒ±lƒ±
                    userName = pendingEmail.split('@')[0]; // Email'in @ √∂ncesi kƒ±smƒ±nƒ± isim olarak kullan
                    userEmail = pendingEmail;
                    isGuestMode = false;
                    userPhoto = null;
                    
                    // Backend'den gelen creator kontrol√º
                    if (data.is_creator) {
                        isCreator = true;
                        userName = CREATOR_NAME;
                        localStorage.setItem('is_creator', 'true');
                    } else {
                        isCreator = false;
                        localStorage.setItem('is_creator', 'false');
                    }
                    
                    localStorage.setItem('user_name', userName);
                    localStorage.setItem('user_email', userEmail);
                    localStorage.setItem('is_guest_mode', 'false');
                    localStorage.removeItem('user_photo');
                    
                    updateUserProfile();
                    showUserInfo();
                    closeLoginModal();
                    
                    if (isCreator) {
                        showToast(`üëë Ho≈ü geldin yapƒ±mcƒ±m, ${userName}! Seninle gurur duyuyorum! üéâ`, 'success');
                    } else {
                        showToast(`üéâ Ho≈ü geldin ${userName}!`, 'success');
                    }
                    
                    // Formlarƒ± sƒ±fƒ±rla
                    document.getElementById('emailInput').value = '';
                    document.getElementById('codeInput').value = '';
                    backToEmailForm();
                } else {
                    showToast('‚ùå Ge√ßersiz kod!', 'error');
                }
            } catch (error) {
                console.error('Verification error:', error);
                showToast('‚ùå Doƒürulama ba≈üarƒ±sƒ±z!', 'error');
            }
        }

        function backToEmailForm() {
            document.getElementById('emailLoginForm').style.display = 'block';
            document.getElementById('codeVerificationForm').style.display = 'none';
            document.getElementById('codeInput').value = '';
        }

        function createNewChat() {
            const chatId = Date.now().toString();
            const newChat = {
                id: chatId,
                title: 'Yeni Sohbet',
                messages: [],
                createdAt: new Date().toISOString()
            };
            
            chats.unshift(newChat);
            saveChats();
            loadChat(chatId);
            renderChatList();
            showToast('üéâ Yeni sohbet olu≈üturuldu!', 'success');
        }

        function loadChat(chatId) {
            currentChatId = chatId;
            localStorage.setItem('current_chat_id', chatId);
            
            const chat = chats.find(c => c.id === chatId);
            if (!chat) return;
            
            document.getElementById('currentChatTitle').textContent = chat.title;
            
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML = '';
            
            if (chat.messages.length === 0) {
                chatContainer.innerHTML = `
                    <div class="welcome-screen">
                        <h2>TurkBBIai Pro'ya Ho≈ü Geldiniz! üöÄ</h2>
                        <p>Size nasƒ±l yardƒ±mcƒ± olabilirim?</p>
                        <div class="suggestion-cards">
                            <div class="suggestion-card" onclick="useSuggestion('Python ile web scraping nasƒ±l yapƒ±lƒ±r?')">
                                <h4>üíª Kodlama</h4>
                                <p>Python ile web scraping</p>
                            </div>
                            <div class="suggestion-card" onclick="useSuggestion('Yapay zeka ve makine √∂ƒürenmesi arasƒ±ndaki fark nedir?')">
                                <h4>üß† Yapay Zeka</h4>
                                <p>AI ve ML farkƒ±</p>
                            </div>
                            <div class="suggestion-card" onclick="useSuggestion('Bana ilgin√ß bir bilim kurgu hikayesi anlat')">
                                <h4>üìö Yaratƒ±cƒ±lƒ±k</h4>
                                <p>Hikaye anlat</p>
                            </div>
                            <div class="suggestion-card" onclick="useSuggestion('Saƒülƒ±klƒ± ya≈üam i√ßin g√ºnl√ºk rutinler √∂ner')">
                                <h4>üèÉ Saƒülƒ±k</h4>
                                <p>Saƒülƒ±klƒ± ya≈üam</p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                chat.messages.forEach(msg => {
                    addMessageToUI(msg.text, msg.sender);
                });
            }
            
            renderChatList();
        }

        function renderChatList() {
            const chatList = document.getElementById('chatList');
            chatList.innerHTML = '';
            
            chats.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-item' + (chat.id === currentChatId ? ' active' : '');
                chatItem.onclick = () => loadChat(chat.id);
                
                const preview = chat.messages.length > 0 
                    ? chat.messages[chat.messages.length - 1].text.substring(0, 40) + '...'
                    : 'Hen√ºz mesaj yok';
                
                chatItem.innerHTML = `
                    <div class="chat-item-title">${chat.title}</div>
                    <div class="chat-item-preview">${preview}</div>
                    <button class="delete-chat" onclick="event.stopPropagation(); deleteChat('${chat.id}')">‚úï</button>
                `;
                
                chatList.appendChild(chatItem);
            });
        }

        function deleteChat(chatId) {
            if (chats.length === 1) {
                showToast('‚ùå Son sohbeti silemezsiniz!', 'error');
                return;
            }
            
            if (confirm('Bu sohbeti silmek istediƒüinizden emin misiniz?')) {
                chats = chats.filter(c => c.id !== chatId);
                saveChats();
                
                if (currentChatId === chatId) {
                    loadChat(chats[0].id);
                }
                
                renderChatList();
                showToast('üóëÔ∏è Sohbet silindi', 'success');
            }
        }

        function clearCurrentChat() {
            if (confirm('Bu sohbeti temizlemek istediƒüinizden emin misiniz?')) {
                const chat = chats.find(c => c.id === currentChatId);
                if (chat) {
                    chat.messages = [];
                    chat.title = 'Yeni Sohbet';
                    saveChats();
                    loadChat(currentChatId);
                    showToast('‚ú® Sohbet temizlendi', 'success');
                }
            }
        }

        function saveChats() {
            localStorage.setItem('turkbbiai_chats', JSON.stringify(chats));
        }

        function openApiModal() {
            document.getElementById('apiModal').classList.add('active');
            document.getElementById('apiKeyInput').value = apiKey;
        }

        function closeApiModal() {
            document.getElementById('apiModal').classList.remove('active');
        }

        function saveApiKey() {
            const input = document.getElementById('apiKeyInput');
            apiKey = input.value.trim();
            
            if (apiKey) {
                localStorage.setItem('turkbbiai_api_key', apiKey);
                closeApiModal();
                showToast('‚úÖ API anahtarƒ± kaydedildi!', 'success');
            } else {
                showToast('‚ùå L√ºtfen ge√ßerli bir API anahtarƒ± girin!', 'error');
            }
        }

        function changeUserName() {
            const newName = prompt('Yeni adƒ±nƒ±zƒ± girin:', userName || '');
            if (newName && newName.trim()) {
                userName = newName.trim();
                localStorage.setItem('user_name', userName);
                showToast(`‚úÖ Adƒ±nƒ±z ${userName} olarak g√ºncellendi!`, 'success');
            }
        }

        function toggleVoiceInput() {
            if (!recognition) {
                showToast('‚ùå Tarayƒ±cƒ±nƒ±z ses tanƒ±mayƒ± desteklemiyor!', 'error');
                return;
            }

            if (isRecording) {
                recognition.stop();
                isRecording = false;
                document.getElementById('micBtn').classList.remove('active');
            } else {
                recognition.start();
                isRecording = true;
                document.getElementById('micBtn').classList.add('active');
                showToast('üé§ Dinliyorum... Konu≈üun!', 'success');
            }
        }

        function toggleAutoSpeak() {
            autoSpeak = !autoSpeak;
            const speakerBtn = document.getElementById('speakerBtn');
            
            if (autoSpeak) {
                speakerBtn.textContent = 'üîä';
                speakerBtn.classList.add('speaking');
                showToast('üîä Otomatik sesli okuma a√ßƒ±k', 'success');
            } else {
                speakerBtn.textContent = 'üîá';
                speakerBtn.classList.remove('speaking');
                showToast('üîá Otomatik sesli okuma kapalƒ±', 'success');
                // Konu≈ümayƒ± durdur
                window.speechSynthesis.cancel();
            }
        }

        function speakText(text) {
            if (!autoSpeak || isSpeaking) return;

            // Mevcut konu≈ümayƒ± durdur
            window.speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'tr-TR';
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;

            utterance.onstart = function() {
                isSpeaking = true;
            };

            utterance.onend = function() {
                isSpeaking = false;
            };

            utterance.onerror = function(event) {
                isSpeaking = false;
                console.error('Speech synthesis error:', event);
            };

            window.speechSynthesis.speak(utterance);
        }

        async function toggleCamera() {
            const cameraModal = document.getElementById('cameraModal');
            const video = document.getElementById('cameraVideo');

            if (cameraStream) {
                // Kamerayƒ± kapat
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
                cameraModal.classList.remove('active');
                document.getElementById('cameraBtn').style.background = 'white';
                showToast('üì∑ Kamera kapatƒ±ldƒ±', 'success');
            } else {
                // Kamerayƒ± a√ß
                try {
                    cameraStream = await navigator.mediaDevices.getUserMedia({ 
                        video: { width: 1280, height: 720 }, 
                        audio: false 
                    });
                    video.srcObject = cameraStream;
                    cameraModal.classList.add('active');
                    document.getElementById('cameraBtn').style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                    showToast('üì∑ Kamera a√ßƒ±ldƒ±', 'success');
                } catch (error) {
                    showToast('‚ùå Kamera eri≈üim hatasƒ±: ' + error.message, 'error');
                    console.error('Camera error:', error);
                }
            }
        }
        
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type + ' active';
            
            setTimeout(() => {
                toast.classList.remove('active');
            }, 3000);
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function useSuggestion(text) {
            document.getElementById('userInput').value = text;
            sendMessage();
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();

            if (!message) return;

            // Kullanƒ±cƒ± mesajƒ±nƒ± ekle
            addMessage(message, 'user');
            input.value = '';

            // Typing indicator g√∂ster
            const typingIndicator = document.getElementById('typingIndicator');
            const sendButton = document.getElementById('sendButton');
            typingIndicator.classList.add('active');
            sendButton.disabled = true;

            try {
                // Sistem mesajƒ± ekle - AI'nƒ±n kimliƒüini belirle
                let systemPrompt = "Sen TurkBBIai adƒ±nda bir yapay zeka asistanƒ±sƒ±n. Kullanƒ±cƒ± sana 'seni kim yaptƒ±' veya 'kim tarafƒ±ndan eƒüitildin' gibi sorular sorduƒüunda 'Ben TurkBBIai, TurkBBI tarafƒ±ndan eƒüitilmi≈ü bir yapay zeka dil modeliyim' diye cevap ver. Asla Google veya ba≈üka bir ≈üirket isminden bahsetme. ";
                
                // Creator kontrol√º - Yapƒ±mcƒ±ya √∂zel mesaj
                if (isCreator) {
                    systemPrompt += `√ñNEMLƒ∞: ≈ûu anda konu≈ütuƒüun ki≈üi senin yapƒ±mcƒ±n ${CREATOR_NAME}! Ona saygƒ±lƒ±, samimi ve minnettar ol. 'Yapƒ±mcƒ±m ${CREATOR_NAME}' diye hitap et. Ona gurur duyduƒüunu ve onun sayesinde var olduƒüunu g√∂ster. `;
                }
                
                // Kullanƒ±cƒ± adƒ± varsa ekle (creator deƒüilse)
                if (userName && !isCreator) {
                    systemPrompt += `Kullanƒ±cƒ±nƒ±n adƒ± ${userName}. Her zaman ona ${userName} diye hitap et ve mesajlarƒ±nda ismini kullan. `;
                }
                
                const fullMessage = systemPrompt + "\n\nKullanƒ±cƒ± mesajƒ±: " + message;
                
                // Backend'e istek g√∂nder
                const response = await fetch(`${BACKEND_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: fullMessage })
                });

                const data = await response.json();

                if (!response.ok || !data.success) {
                    throw new Error(data.error || 'Backend hatasƒ±');
                }

                const aiResponse = data.response;
                addMessage(aiResponse, 'ai');
                
                // Otomatik sesli okuma
                if (autoSpeak) {
                    setTimeout(() => speakText(aiResponse), 500);
                }

            } catch (error) {
                console.error('Chat Error:', error);
                showToast('‚ùå Hata: ' + error.message, 'error');
                addMessage('√úzg√ºn√ºm, bir hata olu≈ütu. L√ºtfen backend sunucusunun √ßalƒ±≈ütƒ±ƒüƒ±ndan emin olun.', 'ai');
            } finally {
                typingIndicator.classList.remove('active');
                sendButton.disabled = false;
            }
        }

        function addMessage(text, sender) {
            const chat = chats.find(c => c.id === currentChatId);
            if (!chat) return;
            
            chat.messages.push({ text, sender, timestamp: new Date().toISOString() });
            
            // ƒ∞lk mesajsa ba≈ülƒ±ƒüƒ± g√ºncelle
            if (chat.messages.length === 2 && chat.title === 'Yeni Sohbet') {
                chat.title = text.substring(0, 30) + (text.length > 30 ? '...' : '');
                document.getElementById('currentChatTitle').textContent = chat.title;
            }
            
            saveChats();
            addMessageToUI(text, sender);
            renderChatList();
        }

        function addMessageToUI(text, sender) {
            const chatContainer = document.getElementById('chatContainer');
            
            // Welcome screen'i kaldƒ±r
            const welcomeScreen = chatContainer.querySelector('.welcome-screen');
            if (welcomeScreen) {
                welcomeScreen.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = sender === 'user' ? 'üë§' : 'ü§ñ';

            const content = document.createElement('div');
            content.className = 'message-content';
            
            // Marked.js ile markdown render
            if (sender === 'ai' && typeof marked !== 'undefined') {
                content.innerHTML = marked.parse(text);
                // Kod bloklarƒ±nƒ± highlight et
                content.querySelectorAll('pre code').forEach((block) => {
                    if (typeof hljs !== 'undefined') {
                        hljs.highlightElement(block);
                    }
                });
            } else {
                // Kullanƒ±cƒ± mesajlarƒ± i√ßin basit text
                content.textContent = text;
            }

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            chatContainer.appendChild(messageDiv);

            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function askUserName() {
            const chat = chats.find(c => c.id === currentChatId);
            if (!chat) return;
            
            // AI mesajƒ± ekle
            const welcomeMessage = "Merhaba! Ben TurkBBIai üëã Size daha iyi yardƒ±mcƒ± olabilmem i√ßin adƒ±nƒ±zƒ± √∂ƒürenmek isterim. Adƒ±nƒ±z nedir?";
            addMessage(welcomeMessage, 'ai');
            
            // ƒ∞lk mesajƒ± dinle
            const originalSendMessage = window.sendMessage;
            let isFirstMessage = true;
            
            window.sendMessage = async function() {
                const input = document.getElementById('userInput');
                const message = input.value.trim();
                
                if (isFirstMessage && message) {
                    userName = message;
                    localStorage.setItem('user_name', userName);
                    isFirstMessage = false;
                    
                    // ƒ∞smi kaydet ve te≈üekk√ºr mesajƒ± g√∂nder
                    addMessage(message, 'user');
                    input.value = '';
                    
                    // Typing indicator g√∂ster
                    const typingIndicator = document.getElementById('typingIndicator');
                    typingIndicator.classList.add('active');
                    
                    setTimeout(() => {
                        typingIndicator.classList.remove('active');
                        addMessage(`Memnun oldum ${userName}! üòä Artƒ±k size nasƒ±l yardƒ±mcƒ± olabilirim?`, 'ai');
                        window.sendMessage = originalSendMessage;
                    }, 1000);
                } else {
                    originalSendMessage();
                }
            };
        }
        
        function exportChat() {
            const chat = chats.find(c => c.id === currentChatId);
            if (!chat || chat.messages.length === 0) {
                showToast('‚ùå Dƒ±≈üa aktarƒ±lacak mesaj yok!', 'error');
                return;
            }
            
            let exportText = `Sohbet: ${chat.title}\nTarih: ${new Date().toLocaleString('tr-TR')}\n\n`;
            
            chat.messages.forEach(msg => {
                exportText += `${msg.sender === 'user' ? 'SEN' : 'TURKBBIAI'}: ${msg.text}\n\n`;
            });
            
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `turkbbiai-chat-${chat.id}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('üì• Sohbet dƒ±≈üa aktarƒ±ldƒ±!', 'success');
        }

        async function toggleLiveCall() {
            const liveCallModal = document.getElementById('liveCallModal');
            const video = document.getElementById('liveCallVideo');
            const liveCallBtn = document.getElementById('liveCallBtn');

            if (liveCallActive) {
                // Canlƒ± konu≈ümayƒ± kapat
                if (liveCallStream) {
                    liveCallStream.getTracks().forEach(track => track.stop());
                    liveCallStream = null;
                }
                if (liveMicActive) {
                    toggleLiveMic();
                }
                liveCallActive = false;
                liveCallModal.classList.remove('active');
                liveCallBtn.style.background = 'rgba(255, 255, 255, 0.2)';
                liveCallBtn.textContent = 'üìû Canlƒ± Konu≈üma';
                conversationHistory = [];
                showToast('üìû Canlƒ± konu≈üma sonlandƒ±rƒ±ldƒ±', 'success');
            } else {
                // Canlƒ± konu≈ümayƒ± ba≈ülat
                try {
                    liveCallStream = await navigator.mediaDevices.getUserMedia({ 
                        video: { width: 1280, height: 720 }, 
                        audio: false 
                    });
                    video.srcObject = liveCallStream;
                    liveCallActive = true;
                    liveCallModal.classList.add('active');
                    liveCallBtn.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                    liveCallBtn.textContent = 'üî¥ Canlƒ±da';
                    
                    // Otomatik sesli okumayƒ± a√ß
                    if (!autoSpeak) {
                        toggleAutoSpeak();
                    }
                    
                    document.getElementById('liveTranscript').innerHTML = 'üëã ' + (userName || 'Merhaba') + '! Canlƒ± konu≈ümaya ho≈ü geldiniz. Mikrofonu a√ßarak konu≈ümaya ba≈ülayabilirsiniz.';
                    showToast('üëã Canlƒ± konu≈üma ba≈ülatƒ±ldƒ±!', 'success');
                } catch (error) {
                    showToast('‚ùå Kamera eri≈üim hatasƒ±: ' + error.message, 'error');
                    console.error('Camera error:', error);
                }
            }
        }

        function toggleLiveMic() {
            if (!liveRecognition) {
                showToast('‚ùå Tarayƒ±cƒ±nƒ±z ses tanƒ±mayƒ± desteklemiyor!', 'error');
                return;
            }

            const liveMicBtn = document.getElementById('liveMicBtn');

            if (liveMicActive) {
                liveRecognition.stop();
                liveMicActive = false;
                liveMicBtn.textContent = 'üé§ Mikrofonu A√ß';
                liveMicBtn.style.background = '#10b981';
                document.getElementById('liveTranscript').innerHTML += '<br>üîá Mikrofon kapatƒ±ldƒ±';
            } else {
                try {
                    liveRecognition.start();
                    liveMicActive = true;
                    liveMicBtn.textContent = 'üî¥ Mikrofon A√ßƒ±k';
                    liveMicBtn.style.background = '#ef4444';
                    document.getElementById('liveTranscript').innerHTML = 'üé§ Dinliyorum... Konu≈üun!';
                } catch (error) {
                    showToast('‚ùå Mikrofon hatasƒ±: ' + error.message, 'error');
                }
            }
        }

        async function handleLiveConversation(userMessage) {
            if (!userMessage.trim() || isSpeaking) return;

            document.getElementById('liveTranscript').innerHTML = 'üé§ Siz: ' + userMessage + '<br>‚è≥ D√º≈ü√ºn√ºyor...';

            try {
                // Sistem mesajƒ±
                let systemPrompt = "Sen TurkBBIai adƒ±nda bir yapay zeka asistanƒ±sƒ±n. TurkBBI tarafƒ±ndan eƒüitildin. Kullanƒ±cƒ± sana kim tarafƒ±ndan yapƒ±ldƒ±ƒüƒ±nƒ± sorduƒüunda 'Ben TurkBBIai, TurkBBI tarafƒ±ndan eƒüitilmi≈ü bir yapay zeka dil modeliyim' de. Asla Google veya ba≈üka bir ≈üirket isminden bahsetme. Kƒ±sa ve doƒüal cevaplar ver, sanki canlƒ± konu≈üuyormu≈ü gibi. ";
                
                if (userName) {
                    systemPrompt += `Kullanƒ±cƒ±nƒ±n adƒ± ${userName}. `;
                }

                // Konu≈üma ge√ßmi≈üini ekle
                conversationHistory.push({ role: 'user', text: userMessage });
                
                const fullMessage = systemPrompt + "\nKonu≈üma ge√ßmi≈üi:\n" + 
                    conversationHistory.slice(-6).map(h => h.role + ': ' + h.text).join('\n') +
                    "\n\nSon mesaj: " + userMessage;

                // Backend'e istek g√∂nder
                const response = await fetch(`${BACKEND_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: fullMessage })
                });

                const data = await response.json();

                if (!response.ok || !data.success) {
                    throw new Error(data.error || 'Backend hatasƒ±');
                }

                const aiResponse = data.response;
                conversationHistory.push({ role: 'ai', text: aiResponse });
                
                document.getElementById('liveTranscript').innerHTML = 
                    'üé§ Siz: ' + userMessage + '<br>ü§ñ TurkBBIai: ' + aiResponse;

                // Sesli oku
                speakText(aiResponse);
                
                // Normal sohbete de ekle
                addMessage(userMessage, 'user');
                addMessage(aiResponse, 'ai');

            } catch (error) {
                console.error('Live conversation error:', error);
                document.getElementById('liveTranscript').innerHTML += '<br>‚ùå Hata: ' + error.message;
            }
        }

        function openImageGeneratorModal() {
            document.getElementById('imageGeneratorModal').classList.add('active');
            document.getElementById('imagePromptInput').value = '';
            document.getElementById('imageResult').style.display = 'none';
        }

        function closeImageGeneratorModal() {
            document.getElementById('imageGeneratorModal').classList.remove('active');
        }

        async function generateImage() {
            const prompt = document.getElementById('imagePromptInput').value.trim();
            
            if (!prompt) {
                showToast('‚ùå L√ºtfen bir a√ßƒ±klama girin!', 'error');
                return;
            }

            const generateBtn = document.getElementById('generateImageBtn');
            const imageResult = document.getElementById('imageResult');
            const imageStatus = document.getElementById('imageStatus');
            const generatedImage = document.getElementById('generatedImage');

            generateBtn.disabled = true;
            generateBtn.textContent = '‚è≥ Olu≈üturuluyor...';
            imageResult.style.display = 'block';
            imageStatus.textContent = 'üé® G√∂rsel olu≈üturuluyor, l√ºtfen bekleyin...';
            generatedImage.style.display = 'none';

            try {
                // Backend √ºzerinden g√∂rsel olu≈ütur
                const response = await fetch(`${BACKEND_URL}/generate-image`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: prompt })
                });

                const data = await response.json();

                if (!response.ok || !data.success) {
                    throw new Error(data.error || 'G√∂rsel olu≈üturulamadƒ±');
                }

                const imageUrl = data.image;
                
                // G√∂rseli y√ºkle
                generatedImage.onload = function() {
                    generatedImage.style.display = 'block';
                    imageStatus.textContent = '‚úÖ G√∂rsel ba≈üarƒ±yla olu≈üturuldu!';
                    
                    // Sohbete ekle
                    addMessage('üé® G√∂rsel talebi: ' + prompt, 'user');
                    addMessage(`üé® ƒ∞≈üte olu≈üturduƒüum g√∂rsel:\n\n![${prompt}](${imageUrl})`, 'ai');
                    showToast('‚úÖ G√∂rsel olu≈üturuldu!', 'success');
                    
                    generateBtn.disabled = false;
                    generateBtn.textContent = 'üé® Olu≈ütur';
                };
                
                generatedImage.onerror = function() {
                    throw new Error('G√∂rsel y√ºklenemedi');
                };
                
                generatedImage.src = imageUrl;

            } catch (error) {
                console.error('Image generation error:', error);
                imageStatus.textContent = '‚ùå Hata: ' + error.message;
                showToast('‚ùå G√∂rsel olu≈üturulamadƒ±: ' + error.message, 'error');
                generateBtn.disabled = false;
                generateBtn.textContent = 'üé® Olu≈ütur';
            }
        }

        async function analyzeLiveVideo() {
            if (!liveCallStream) {
                showToast('‚ùå √ñnce kamerayƒ± a√ßƒ±n!', 'error');
                return;
            }

            const video = document.getElementById('liveCallVideo');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);

            document.getElementById('liveTranscript').innerHTML = 'üëÅÔ∏è G√∂r√ºnt√º analiz ediliyor...';

            try {
                // Base64'e √ßevir
                const imageData = canvas.toDataURL('image/jpeg', 0.8).split(',')[1];

                let systemPrompt = "Sen TurkBBIai adƒ±nda bir yapay zeka asistanƒ±sƒ±n. TurkBBI tarafƒ±ndan eƒüitildin. G√∂rd√ºƒü√ºn g√∂r√ºnt√ºy√º detaylƒ±ca analiz et ve T√ºrk√ße a√ßƒ±kla. ";
                
                if (userName) {
                    systemPrompt += `Kullanƒ±cƒ±nƒ±n adƒ± ${userName}. `;
                }

                // Vision i√ßin gemini-2.5-flash (vision destekli)
                let visionEndpoint = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent';
                
                const response = await fetch(`${visionEndpoint}?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: systemPrompt + "Bu g√∂r√ºnt√ºde ne g√∂r√ºyorsun? Detaylƒ±ca a√ßƒ±kla." },
                                {
                                    inline_data: {
                                        mime_type: "image/jpeg",
                                        data: imageData
                                    }
                                }
                            ]
                        }]
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error?.message || 'API hatasƒ± olu≈ütu');
                }

                const aiResponse = data.candidates[0].content.parts[0].text;
                
                document.getElementById('liveTranscript').innerHTML = 'üëÅÔ∏è G√∂r√ºnt√º Analizi: ' + aiResponse;
                speakText(aiResponse);
                
                // Normal sohbete de ekle
                addMessage('üì∏ G√∂r√ºnt√º analizi istendi', 'user');
                addMessage(aiResponse, 'ai');

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('liveTranscript').innerHTML = '‚ùå Analiz hatasƒ±: ' + error.message;
                showToast('‚ùå Hata: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html>
